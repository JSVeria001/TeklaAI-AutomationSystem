
name: Bootstrap TeklaAI.UI (Material Design)

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # 1) Create a PowerShell script as a file (using bash here-doc)
      - name: Write bootstrap.ps1
        shell: bash
        run: |
          set -e
          cat > bootstrap.ps1 << 'PS1_EOF'
          $ErrorActionPreference = 'Stop'

          function Info($m){Write-Host "[INFO] $m" -ForegroundColor Cyan}
          function Ok($m){Write-Host "[ OK ] $m" -ForegroundColor Green}
          function Warn($m){Write-Host "[WARN] $m" -ForegroundColor Yellow}
          function Err($m){Write-Host "[ERR ] $m" -ForegroundColor Red}

          $ui = "TeklaAI.UI"
          if (-not (Test-Path $ui)) { Err "Cannot find $ui folder in repo root."; exit 1 }

          # --- Ensure folders exist ---
          $folders = @("$ui/Views","$ui/ViewModels","$ui/Helpers","$ui/Converters")
          foreach($f in $folders){
            if(-not (Test-Path $f)){ New-Item -ItemType Directory -Path $f | Out-Null; Ok "Created $f" }
          }

          # --- App.xaml (MaterialDesign BundledTheme + MD2 defaults) ---
          @'
          <Application x:Class="TeklaAI.UI.App"
                       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                       xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                       xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                       StartupUri="Views/MainWindow.xaml">
              <Application.Resources>
                  <ResourceDictionary>
                      <ResourceDictionary.MergedDictionaries>
                          <materialDesign:BundledTheme BaseTheme="Light"
                                                       PrimaryColor="Blue"
                                                       SecondaryColor="LightBlue" />
                          <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesign2.Defaults.xaml" />
                      </ResourceDictionary.MergedDictionaries>
                  </ResourceDictionary>
              </Application.Resources>
          </Application>
          '@ | Set-Content -Path "$ui/App.xaml" -Encoding UTF8

          # --- MainWindow.xaml under Views ---
          @'
          <Window x:Class="TeklaAI.UI.Views.MainWindow"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                  xmlns:conv="clr-namespace:TeklaAI.UI.Converters"
                  Title="Tekla AI Automation System"
                  Height="800" Width="1200"
                  WindowStartupLocation="CenterScreen"
                  Background="{DynamicResource MaterialDesignPaper}">
              <Window.Resources>
                  <conv:BoolToStatusConverter x:Key="BoolToStatusConverter"/>
              </Window.Resources>

              <DockPanel>
                  <!-- Top -->
                  <ToolBar DockPanel.Dock="Top" Background="{DynamicResource MaterialDesignCardBackground}">
                      <TextBlock Text="Tekla AI Automation System" FontSize="18" FontWeight="Bold" Margin="10"/>
                  </ToolBar>

                  <!-- Bottom -->
                  <StatusBar DockPanel.Dock="Bottom" Background="{DynamicResource MaterialDesignCardBackground}">
                      <StatusBarItem>
                          <TextBlock Text="{Binding StatusMessage}" Margin="10,0,20,0"/>
                      </StatusBarItem>
                      <StatusBarItem>
                          <TextBlock Text="{Binding IsConnectedToTekla, Converter={StaticResource BoolToStatusConverter}}"/>
                      </StatusBarItem>
                  </StatusBar>

                  <!-- Left Nav -->
                  <StackPanel DockPanel.Dock="Left" Width="220" Background="{DynamicResource MaterialDesignCardBackground}">
                      <Button Content="Dashboard"      Command="{Binding NavigateDashboardCommand}" Style="{DynamicResource MaterialDesignRaisedButton}" Margin="10"/>
                      <Button Content="Drawing"        Command="{Binding NavigateDrawingCommand}"   Style="{DynamicResource MaterialDesignRaisedButton}" Margin="10"/>
                      <Button Content="Modelling"      Command="{Binding NavigateModellingCommand}" Style="{DynamicResource MaterialDesignRaisedButton}" Margin="10"/>
                      <Button Content="Tekla Export"   Command="{Binding NavigateExportCommand}"    Style="{DynamicResource MaterialDesignRaisedButton}" Margin="10"/>
